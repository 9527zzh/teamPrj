<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Hello, World</title>
<style type="text/css">
html {
	height: 100%
}

body {
	height: 100%;
	margin: 0px;
	padding: 0px
}
#container {
	height: 100%;
	background-color: black
}
</style>
<script type="text/javascript"
	src="http://api.map.baidu.com/getscript?v=3.0&ak=fjl7zIz6n8XdXzc1nI8G1yv9LLzqh7XO">
	//v1.5版本的引用方式：src="http://api.map.baidu.com/api?v=1.5&ak=您的密钥"
	//v1.4版本及以前版本的引用方式：src="http://api.map.baidu.com/api?v=1.4&key=您的密钥&callback=initialize"
</script>
<!-- 这两个js是可以在地图上画点 -->
<script type="text/javascript"
	src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript"
	src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
</head>

<body>
    <!-- 创建一个地图容器 -->
	<div id="container"></div>

	<script type="text/javascript">
		var map = new BMap.Map("container"); // 创建地图实例  
		map.enableScrollWheelZoom(true); //开启滑轮功能
		var point = new BMap.Point(113.912690161, 35.3072575577); // 创建初始点点坐标 (新乡的坐标) 
		map.centerAndZoom(point, 15); // 初始化地图，设置中心点坐标和地图级别  

		/* 获得当前定位的方法 */
		function myFun(result) {
			var cityName = result.name;
			map.setCenter(cityName); //将定位再次更改为定位的城市
			//	alert("当前定位城市:"+cityName);
		}
		var myCity = new BMap.LocalCity();
		myCity.get(myFun);

		/* 创建数组放值点位 */
		var markers = [];
		var pt = null;
		//创建点击弹出的信息框
		var opts = {
			width : 250, // 信息窗口宽度    
			height : 100, // 信息窗口高度    
			title : "Hello" // 信息窗口标题   
		}
		var infoWindow = new BMap.InfoWindow("<a href='1.jsp'>点我啊</a>", opts); // 创建信息窗口对象    

		function open(loc) {
			map.openInfoWindow(infoWindow, loc); // 打开信息窗口 
		}
	</script>
	<script type="text/javascript">
	$(function(){
		start();
	})
	
	function start(){
		$.ajax({
			type:"GET",
			url:"../stations",
			success:function(msg){
				for (var i = 0; i < msg.length; i++) {
					pt = new BMap.Point(msg[i].longitude, msg[i].latitude);
					var marker = new BMap.Marker(pt)
					marker.addEventListener("click", function(e) {
						console.log(e.point)
						open(e.point);
					});
					markers.push(marker);
				}
				/* 将数组内坐标进行展示 */
				var markerClusterer = new BMapLib.MarkerClusterer(map, {
					markers : markers
				});
			}
		})
	}
	</script>
</body>
</html>